# PTP

<h1>SMB Enumeration Guide<h1>
  
  
<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>NetBOIS_Concept</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>NetBOIS_Concept</h1><br/>What is NetBOIS?<br />is service in windows allow users to share files, printer among machine on a LAN.<br /><br />NetBOIS ports: (PC&#39;s on NetBOIS LAN communicate either by establishing session or datagram)<br />1- UDP 137 name servcie  (maps NetBOIS name to IP address )<br /><div class="codebox"><div class="codebox">#&nbsp;very&nbsp;important&nbsp;to&nbsp;notice&nbsp;number&nbsp;&lt;20&gt;&nbsp;means&nbsp;file&nbsp;sharing&nbsp;is&nbsp;enabled&nbsp;and&nbsp;we&nbsp;can&nbsp;access&nbsp;them&nbsp;<br />#in&nbsp;windows&nbsp;<br />nbtstat&nbsp;-n&nbsp;&nbsp;<br />#&nbsp;linux&nbsp;<br />nbtscan&nbsp;-v&nbsp;&lt;target_ip&gt;<br /></div></div><br /><br />3- UDP 138  datagram service (allow sending messages to NetBOIS name over UDP + allow comunication to be established without the need for sesstion to be established) <br /><br />5- TCP  139 session service  (the most commonly one of NetBOIS service + it allow two names to established a connection in order to exchange data)<br /><br />How NetBOIS works (sessiton service)?<br />1- NetBIOS name to IP address &gt;&gt; NetBOIS name service<br />2- TCP connection  between 2 devices <br />3- device that start the connection sends “NetBOIS session Request” over TCP connection<br />4- session will be established<br /><br /><br />SMB (Server Message Block)<br /><br />SMB ports:<br />139 TCP &gt;&gt; before windows 2000 “SMB was rely on NetBOIS session” <br />445 TCP &gt;&gt; windows 2000 and higher <br /><br /><br />NetBOIS Command and Tools:<br />if you find port 139/445, what to do next is:<br /><br /><strong>1- check for File share </strong><br /><div class="codebox"><div class="codebox"># very&nbsp;important&nbsp;to&nbsp;notice&nbsp;number&nbsp;&lt;20&gt;&nbsp;means&nbsp;file&nbsp;sharing&nbsp;is&nbsp;enabled&nbsp;and&nbsp;we&nbsp;can&nbsp;access&nbsp;them&nbsp;<br />#in&nbsp;windows&nbsp;<br />nbtstat&nbsp;-a&nbsp;&lt;ip&gt;<br />#linux&nbsp;<br />nmblookup&nbsp;-A&nbsp;&lt;ip&gt;</div></div><br /><br /><br /><strong>2- Check Null Session</strong> “List shares on a machine using NULL Session” <br /><div class="codebox"><div class="codebox">#linux<br />#-L&nbsp;:&nbsp;get&nbsp;a&nbsp;list&nbsp;of&nbsp;shares&nbsp;for&nbsp;the&nbsp;given&nbsp;host<br />smbclient&nbsp;-L&nbsp;&lt;ip&gt;&nbsp;<br />#&nbsp;or&nbsp;use&nbsp;enum4linux&nbsp;<br />enum4linux&nbsp;-a&nbsp;&lt;ip&gt;<br />#in&nbsp;windows&nbsp;“null&nbsp;session”<br />C:\&gt;net&nbsp;use&nbsp;\\10.130.40.70\IPC$&nbsp;&quot;&quot;&nbsp;/u:&quot;&quot;</div></div><br /><br />• <strong>List shares on a machine using a valid username + password <br /></strong><div class="codebox"><div class="codebox">#This&nbsp;will&nbsp;attempt&nbsp;to&nbsp;connect&nbsp;to&nbsp;the&nbsp;share.&nbsp;Can&nbsp;try&nbsp;without&nbsp;a&nbsp;password&nbsp;(or&nbsp;sending&nbsp;a&nbsp;blank&nbsp;password)&nbsp;and&nbsp;still&nbsp;potentially&nbsp;connect.<br />smbclient&nbsp;-L&nbsp;&lt;target-IP&gt;&nbsp;-U&nbsp;username%password</div></div><br /><br />• <strong>Connect to a valid share with username </strong>+ password<br /><div class="codebox"><div class="codebox">smbclient&nbsp;\\\\&lt;target_ip&gt;\\&lt;share$&gt;&nbsp;-U&nbsp;username%password<br />#in&nbsp;windows<br />C:&gt;net&nbsp;use&nbsp;\\10.130.40.70\IPC$&nbsp;password&nbsp;/u:administrator</div></div><br /><br /><strong>3- No null session or lack of privileges on the Anonymous user we should do&gt;&gt; SMB Bruteforce<br /><br /></strong>•  use Metasploit smb_login <br />• if you got credational go to perviuos step to list shares with username and password <br /><br /><br /><strong><br /><br /><br /></strong></div>
</body>
</html>


